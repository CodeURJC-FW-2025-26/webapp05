<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCG DEVS</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Personalized CSS -->
    <link href="style/style.css" rel="stylesheet">
</head>

<body>
    {{> header}}

    <!-- MAIN CARD SECTION -->
    <main class="store-main" id="cartas">
        <div class="container py-5">
            <!-- Section title -->
            <div class="row mb-5">
                <div class="col-12 text-center">
                    <h2 class="section-title">Our Pokemon Cards</h2>
                    <p class="section-subtitle">Discover the best sellers</p>
                    <!-- Search form -->
                    <form class="d-flex justify-content-center mt-3" method="get" action="/">
                        <input name="q" value="{{q}}" class="form-control me-2" style="max-width:420px;" type="search"
                            placeholder="Search by name" aria-label="Search">
                        <button class="btn btn-outline-primary search-btn" type="submit">Search</button>
                    </form>

                    <!-- Filters: collections and price ranges -->
                    <div class="d-flex justify-content-center gap-2 mt-3 flex-wrap">
                        <!-- Collections -->
                        {{#collections}}
                        <a href="/?collection={{name}}{{#q}}&q={{q}}{{/q}}{{#price}}&price={{value}}{{/price}}"
                            class="btn btn-sm btn-outline-secondary filter-btn {{#current}}active{{/current}}">{{name}}</a>
                        {{/collections}}

                        <!-- Price ranges -->
                        <a href="/?price=lt10{{#q}}&q={{q}}{{/q}}{{#collection}}&collection={{collection}}{{/collection}}"
                            class="btn btn-sm btn-outline-secondary filter-btn {{#price}}{{#is_lt10}}active{{/is_lt10}}{{/price}}">&lt;
                            €10</a>
                        <a href="/?price=10-50{{#q}}&q={{q}}{{/q}}{{#collection}}&collection={{collection}}{{/collection}}"
                            class="btn btn-sm btn-outline-secondary filter-btn {{#price}}{{#is_10_50}}active{{/is_10_50}}{{/price}}">€10
                            - €50</a>
                        <a href="/?price=gt50{{#q}}&q={{q}}{{/q}}{{#collection}}&collection={{collection}}{{/collection}}"
                            class="btn btn-sm btn-outline-secondary filter-btn {{#price}}{{#is_gt50}}active{{/is_gt50}}{{/price}}">&gt;
                            €50</a>

                        <!-- Clear filters -->
                        <a href="/" class="btn btn-sm btn-outline-dark">See all</a>
                    </div>
                </div>
            </div>

            <!-- Card Grid (rendered from DB posts) -->
            <div class="row cards-grid" data-current-page="{{currentPage}}" data-total-pages="{{totalPages}}">
                {{#posts}}
                <div class="col-lg-4 col-md-6 col-xs-12 mb-4">
                    <div class="pokemon-card">
                        <div class="card-image">
                            <img src="/uploads/{{imageFilename}}" alt="{{title}}" class="card-img">
                            <div class="card-overlay">
                                <a href="/post/{{_id}}" class="btn-view-details">See Details</a>
                            </div>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">{{title}}</h3>
                            <div class="card-collection">{{coleccion}}</div>
                            <div class="card-price">€{{precio}}</div>
                        </div>
                    </div>
                </div>
                {{/posts}}
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="text-center my-5" style="display: none;">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading more cards...</p>
            </div>

            <a href="/create_new_card.html" class="btn-view-addCards">Add Cards</a>
        </div>
    </main>

    {{> footer}}

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Infinite Scroll Module -->
    <script type="module">
        import { InfiniteScroll } from '/js/infinite-scroll.js';

        // Initialize immediately
        new InfiniteScroll({
            gridSelector: '.cards-grid',
            loadingSelector: '#loading-indicator',
            threshold: 300
        });
    </script>

</body>

</html>